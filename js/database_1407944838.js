 
/*
  Updated: 2014-08-13 11:47:24.200155
  Readable Source in //Ceres/training/webmaps/Bsouthga_mugroup/webdev_repo/stateOfRetirement/js/
  bsouthga(at)urban(dot)org
*/

function prepData(df){var col_list=[];for(var c=0,l=df.columns.length;c<l;c++){var h=df.columns[c];var cleaned=h.replace(/\W/g,'');col_list.push({"id":cleaned,"name":h,"field":cleaned,"cssClass":cleaned,"sortable":true,"width":col_widths[cleaned]});}var data=[];for(var r=0,l=df.data.length;r<l;r++){var p={id:r};for(var c=0;c<col_list.length;c++)p[col_list[c].field]=df.data[r][c];data.push(p);}return{"c":col_list,"d":data};}$(document).ready(function(){$.getJSON('js/plan_database.json',function(data){var store=prepData(data.plan_database);var options={enableCellNavigation:true,enableColumnReorder:false,frozenColumn:0,rowHeight:100};var dv=new Slick.Data.DataView();var grid=new Slick.Grid("#myGrid",dv,store.c,options);dv.onRowCountChanged.subscribe(function(e,args){grid.updateRowCount();grid.render();});dv.onRowsChanged.subscribe(function(e,args){grid.invalidateRows(args.rows);grid.render();});function excelCol(n){n=n+1;var out='';var mod;while(n>0){mod=((n-1)%26);out=String.fromCharCode(mod+65)+out;n=Math.round((n-mod)/26);}return out;}function genRetPenData(id){var df=data.ret_details[id];var cols=[];var retdata=[];for(var i=0,l=df[0].length;i<l;i++){var n='ret_details'+i;cols.push({"id":n,"name":excelCol(i),"field":n,"width":100});}for(var r=0,l=df.length;r<l;r++){var p={id:r};for(var c=0,cl=df[r].length;c<cl;c++)p['ret_details'+c]=df[r][c];retdata.push(p);}var out={c:cols,d:retdata};return out;}function renderPenaltyTable(id){if(id!==""){var ret_store=genRetPenData(id);ret_dv.setItems(ret_store.d);ret_grid.setColumns(ret_store.c);$('#ret_details_modal').dialog({title:'Additional Details on Early Retirement Penalties: '+id,height:480,width:640,resize:function(e,ui){ret_grid.resizeCanvas();}});ret_grid.resizeCanvas();}}var ret_store=genRetPenData('AKAGE1');var ret_options={enableCellNavigation:true,enableColumnReorder:false,frozenColumn:0};var ret_dv=new Slick.Data.DataView();var ret_grid=new Slick.Grid("#ret_details_grid",ret_dv,ret_store.c,ret_options);ret_dv.onRowCountChanged.subscribe(function(e,args){ret_grid.updateRowCount();ret_grid.render();});ret_dv.onRowsChanged.subscribe(function(e,args){ret_grid.invalidateRows(args.rows);ret_grid.render();});ret_dv.beginUpdate();ret_dv.setItems(store.d);ret_dv.endUpdate();var search={val:"",check:function(item){if(this.val==="")return true;var query=this.val.split(" ");var matches=[];for(var q=0,ql=query.length;q<ql;q++)matches.push(false);for(var v in col_widths)for(var q=0,ql=query.length;q<ql;q++)if(item[v]&&(''+item[v]).toLowerCase().indexOf(query[q])!==-1)matches[q]=true;for(var q=0,ql=query.length;q<ql;q++)if(!matches[q])return false;return true;}};$("#txtSearch").keyup(function(e){search.val=this.value.toLowerCase();dv.refresh();});dv.beginUpdate();dv.setItems(store.d);dv.setFilter(function(i){return search.check(i);});dv.endUpdate();grid.registerPlugin(new Slick.AutoTooltips({enableForCells:true,maxToolTipLength:100}));ret_grid.registerPlugin(new Slick.AutoTooltips({enableForCells:true,maxToolTipLength:100}));grid.onClick.subscribe(function(e,args){var isCol=function(col){return grid.getColumns()[args.cell].field==col;};if(isCol("PlanID")){var url=("http://datatools.urban.org/features/SLEPP/plan_detail.html?planid="+e.target.innerHTML);window.open(url);}if(isCol("Source"))window.open("http://"+e.target.innerHTML.replace("http://","").replace("https://",""));if(isCol("AdditionalDetailsonEarlyRetirementPenalties")){var id=e.target.innerHTML.split(" ")[0].replace(/\W/g,'');renderPenaltyTable(id);}});$('.slick-sort-indicator').remove();grid.onSort.subscribe(function(e,args){var comparer=function(a,b){return(a[args.sortCol.field]>b[args.sortCol.field])?1:-1;};dv.sort(comparer,args.sortAsc);});grid.onActiveCellChanged.subscribe(function(){grid.resetActiveCell();});ret_grid.onActiveCellChanged.subscribe(function(){ret_grid.resetActiveCell();});});});var col_widths={"PlanID":100,"State":100,"PlanName":260,"PenaltyforEarlyRetirement":250,"CoversNewHires1yes0no":150,"Occupation":150,"DeferredRetirementOptionProgramDROP1yes0no":220,"MandatoryRetirement1yes0no":150,"Multiplier":260,"EarlyRetirementFormula":100,"PlanTypeFASFinalAverageSalaryDCDefinedContributionCBCashBalanceHybrid":200,"AdditionalDetailsonEarlyRetirementPenalties":170,"FormulaBenefit":250,"Tier":150,"Notes":880,"SocialSecurityCoverage":100,"VestingyearsNonFASPlan":100,"FinalAverageSalary":150,"EmployerContributionRateNonFASPlan":140,"EmployeeContributionRateNonFASPlan":140,"RetirementEligibilityNormalAgeYearsofService":170,"IncreasesinDeferredVestedBenefits":140,"EmployeeContributionRate":120,"RetirementEligibilityEarlyAgeYearsofService":170,"CostofLivingAdjustment":350,"InterestRateNonFASPlan":100,"DeferredVestedStartDate":100,"Vestingyears":100,"Source":450,"BenefitSupplement":300};