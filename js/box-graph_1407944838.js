 
/*
  Updated: 2014-08-13 11:47:24.850161
  Readable Source in //Ceres/training/webmaps/Bsouthga_mugroup/webdev_repo/stateOfRetirement/js/
  bsouthga(at)urban(dot)org
*/

var grid={},boxWidth,boxHeight,boxTotalCount=0,Rgraph,dataPos,oDataPos={};var boxHolders={under:{},text:{},over:{},outline:{}},jsonPerm,interval,intCount,stateArr=[];var currData;function newBoxGraph(data_subset){var gColors=["#6699CC","#D1DCEE","#ECD7C2","#F9A458","#A02022","#555555"];var gLabels=["A","B","C","D","F","N"];var gTextColors=["#FFFFFF","#000000","#000000","#000000","#FFFFFF","#FFFFFF"];var numWide=3;boxGraph({renderTo:"boxDiv",popup:{popupDiv:"popupDiv",offMouseLeft:0,offMouseTop:30,autoCenter:true,borderColor:"#000000",borderWidth:"1px",backgroundColor:"#FFFFFF",fontFamily:'"helvetica","arial","tahoma","verdana","sans-serif"',opacity:"0.9",padding:"5px 5px 5px 5px"},boxSide:21,boxMargin:2,boxColors:gColors,boxBorder:{width:0,mouseWidth:2,color:"#000000",mouseColor:"#000000",roundCornerRadius:0},boxText:{fontSize:"10px",fontFamily:"Helvetica, Arial, sans-serif",color:gTextColors},maxHeight:{enabled:true,value:410},catMargin:6,catLabels:gLabels,gridWidth:numWide,catSpaceBottom:25,lineThickness:1,lineColor:"#000000",catText:{fontSize:"14px",fontFamily:'"helvetica","arial","tahoma","verdana","sans-serif"',offset:12},animation:{time:250,delay:10,colorFade:100},data:data_subset});}function boxGraph(json){jsonPerm={};jsonPerm=json;currData=json.data;boxTotalCount=0;for(n in json.data)boxTotalCount++;var ls=json.catLabels.length;var maxStack=Math.ceil(boxTotalCount/json.gridWidth);boxWidth=ls*((json.boxMargin*(2*json.gridWidth))+(json.boxSide*json.gridWidth)+json.catMargin)-json.catMargin;if(json.maxHeight.enabled)boxHeight=json.maxHeight.value;else boxHeight=json.catSpaceBottom+json.lineThickness+json.boxMargin+(maxStack*(json.boxSide+(2*json.boxMargin)));grid={};for(i=0;i<json.catLabels.length;i++){var numberSys=0;grid[json.catLabels[i]]=[];for(j=0;j<maxStack;j++){var t=boxHeight-json.catSpaceBottom-json.lineThickness-(2*json.boxMargin)-json.boxSide-(j*((2*json.boxMargin)+json.boxSide));for(k=0;k<json.gridWidth;k++){var startW=i*((json.boxMargin*(2*json.gridWidth))+(json.boxSide*json.gridWidth)+json.catMargin);var l=startW+json.boxMargin+(k*((2*json.boxMargin)+json.boxSide));numberSys++;grid[json.catLabels[i]][numberSys]=[l,t];}}}Rgraph=Raphael(json.renderTo,boxWidth,boxHeight);for(i=0;i<json.catLabels.length;i++){var lTop=boxHeight-json.catSpaceBottom-json.lineThickness;var lLeftS=i*((json.boxMargin*(2*json.gridWidth))+(json.boxSide*json.gridWidth)+json.catMargin);var lLeftE=lLeftS+((json.boxMargin*(2*json.gridWidth))+(json.boxSide*json.gridWidth)+json.catMargin)-json.catMargin;var laTop=lTop+json.catText.offset;var textFix=Math.round((json.catText.fontSize.replace('px','')*1)/10);var laLeft=lLeftS+((lLeftE-lLeftS)/2)-textFix;if(json.catLabels[i]=="N"){line_path=Rgraph.path("M"+lLeftS+","+lTop+"L"+lLeftE+","+lTop+"Z");line_path.attr({"stroke-width":0,"stroke":"#FFFFFF"});}else{line_path=Rgraph.path("M"+lLeftS+","+lTop+"L"+lLeftE+","+lTop+"Z");line_path.attr({"stroke-width":json.lineThickness,"stroke":json.lineColor});}var thisSelect=$('.var.selected').attr('id');var ins=json.catLabels[i],fS=json.catText.fontSize;line_text=Rgraph.text(laLeft,laTop,ins);line_text.attr({"font-size":fS,"font-family":json.catText.fontFamily,"fill":(ins=="N"?"#FFFFFF":json.lineColor)});}$('#'+json.popup.popupDiv).css({position:"absolute","border-style":"solid","border-color":json.popup.borderColor,"border-width":json.popup.borderWidth,"opacity":json.popup.opacity,"display":"none",padding:json.popup.padding,"background-color":json.popup.backgroundColor,"font-family":json.popup.fontFamily});assignData(json);}function assignData(json){var isEmpty={};boxHolders={under:{},text:{},over:{},outline:{}};dataPos={};for(i=0;i<json.catLabels.length;i++)isEmpty[json.catLabels[i]]=0;for(n in json.data){var g=json.data[n],colorPos=$.inArray(g,json.catLabels);isEmpty[g]++;dataPos[n]=[g,isEmpty[g]];boxHolders.under[n]=Rgraph.rect(grid[g][isEmpty[g]][0],grid[g][isEmpty[g]][1],json.boxSide,json.boxSide,json.boxBorder.roundCornerRadius).attr({fill:json.boxColors[colorPos],"stroke-width":json.boxBorder.width,stroke:json.boxBorder.color});}for(n in dataPos){var g1=dataPos[n][0],g2=dataPos[n][1];var textFix=Math.round(json.boxSide/2);var g=json.data[n],colorPos=$.inArray(g,json.catLabels);boxHolders.text[n]=Rgraph.text(grid[g1][g2][0]+textFix-1,grid[g1][g2][1]+textFix,n).attr({"font-size":json.boxText.fontSize,"font-family":json.boxText.fontFamily,"fill":json.boxText.color[colorPos]});}for(n in dataPos){var g1=dataPos[n][0],g2=dataPos[n][1];boxHolders.over[n]=Rgraph.rect(grid[g1][g2][0],grid[g1][g2][1],json.boxSide,json.boxSide,json.boxBorder.roundCornerRadius).attr({fill:"#FFFFFF",opacity:"0"});boxHolders.outline[n]=Rgraph.rect(grid[g1][g2][0],grid[g1][g2][1],json.boxSide,json.boxSide,json.boxBorder.roundCornerRadius).attr({"stroke-width":json.boxBorder.mouseWidth,"stroke-opacity":"0","stroke":json.boxBorder.mouseColor});}}function pos(x,y){if(jsonPerm.popup.autoCenter)var dLeft=$('#'+jsonPerm.popup.popupDiv).width()/2;else var dLeft=0;var posX=x+jsonPerm.popup.offMouseLeft-dLeft,posY=y+jsonPerm.popup.offMouseTop;if(posY<0)posY=0;if(posX<0)posX=0;$('#'+jsonPerm.popup.popupDiv).css({top:posY+"px",left:posX+"px"});}function mOver(e,obj1,obj2){obj1.attr({"stroke-opacity":"1"});obj2.attr({"stroke-opacity":"1"});var state=$(e.target).attr('id');var thisSelect=$('.var.selected').attr('id');if($.inArray(currData[state],["A","B","C","D","F"])!=-1)var ins=currData[state];else if(currData[state]=="N")var ins="Data Not Available";$('#'+jsonPerm.popup.popupDiv).show().html('<b>'+stateFullNameRef[state]+'</b>: '+ins);pos(e.pageX,e.pageY);}function mOut(e,obj1,obj2){obj1.attr({"stroke-opacity":"0"});obj2.attr({"stroke-opacity":"0"});$('#'+jsonPerm.popup.popupDiv).hide();}function dance(newData){clearInterval(interval);currData=newData;changeMapColors();oDataPos={};for(n in dataPos)oDataPos[n]=[dataPos[n][0],dataPos[n][1]];var isEmpty={};dataPos={};for(i=0;i<jsonPerm.catLabels.length;i++)isEmpty[jsonPerm.catLabels[i]]=0;for(n in newData){var g=newData[n],colorPos=$.inArray(g,jsonPerm.catLabels);isEmpty[g]++;dataPos[n]=[g,isEmpty[g]];}intCount=-1;for(n in newData)stateArr.push(n);interval=setInterval(function(){moveBoxes(newData);},jsonPerm.animation.delay);}function moveBoxes(newData){intCount++;if((intCount+1)>=boxTotalCount){clearInterval(interval);interval=setInterval(function(){changeColors(newData);},jsonPerm.animation.time+100);}var n=stateArr[intCount];var textFix=Math.round(jsonPerm.boxSide/2);var X=grid[dataPos[n][0]][dataPos[n][1]][0],Y=grid[oDataPos[n][0]][oDataPos[n][1]][1];boxHolders.under[n].stop().animate({x:X,y:Y},jsonPerm.animation.time/2);boxHolders.text[n].stop().animate({x:X+textFix-1,y:Y+textFix},jsonPerm.animation.time/2);boxHolders.over[n].stop().animate({x:X,y:Y},jsonPerm.animation.time/2);boxHolders.outline[n].stop().animate({x:X,y:Y},jsonPerm.animation.time/2,function(){var X=grid[dataPos[n][0]][dataPos[n][1]][0],Y=grid[dataPos[n][0]][dataPos[n][1]][1];boxHolders.under[n].stop().animate({x:X,y:Y},jsonPerm.animation.time/2);boxHolders.text[n].stop().animate({x:X+textFix-1,y:Y+textFix},jsonPerm.animation.time/2);boxHolders.over[n].stop().animate({x:X,y:Y},jsonPerm.animation.time/2);boxHolders.outline[n].stop().animate({x:X,y:Y},jsonPerm.animation.time/2);});if(newData[n]!="N"){boxHolders.under[n].show();boxHolders.text[n].show();boxHolders.over[n].show();boxHolders.outline[n].show();}}function changeColors(newData){for(n in newData){var colorPos=$.inArray(newData[n],jsonPerm.catLabels);boxHolders.under[n].animate({fill:jsonPerm.boxColors[colorPos]},jsonPerm.animation.colorFade);boxHolders.text[n].animate({fill:jsonPerm.boxText.color[colorPos]},jsonPerm.animation.colorFade);}clearInterval(interval);}var stateFullNameRef={"AL":"Alabama","AK":"Alaska","AZ":"Arizona","AR":"Arkansas","CA":"California","CO":"Colorado","CT":"Connecticut","DE":"Delaware","FL":"Florida","GA":"Georgia","HI":"Hawaii","ID":"Idaho","IL":"Illinois","IN":"Indiana","IA":"Iowa","KS":"Kansas","KY":"Kentucky","LA":"Louisiana","ME":"Maine","MD":"Maryland","MA":"Massachusetts","MI":"Michigan","MN":"Minnesota","MS":"Mississippi","MO":"Missouri","MT":"Montana","NE":"Nebraska","NV":"Nevada","NH":"New Hampshire","NJ":"New Jersey","NM":"New Mexico","NY":"New York","NC":"North Carolina","ND":"North Dakota","OH":"Ohio","OK":"Oklahoma","OR":"Oregon","PA":"Pennsylvania","RI":"Rhode Island","SC":"South Carolina","SD":"South Dakota","TN":"Tennessee","TX":"Texas","UT":"Utah","VT":"Vermont","VA":"Virginia","WA":"Washington","WV":"West Virginia","WI":"Wisconsin","WY":"Wyoming","DC":"Washington, D.C."};